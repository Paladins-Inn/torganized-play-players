---
databaseChangeLog:

- changeSet:
    id: USERS-change-id
    author: rlichti
    context: init
    labels: 'v1.0.4,user'
    dbms: postgresql
    created: '1.0.4'
    changes:    
    - dropColumn:
        tableName: USERS
        columnName: ID
    - dropColumn:
        tableName: PLAYERLOG
        columnName: ID
    - dropColumn:
        tableName: PLAYERLOG
        columnName: PLAYER

    - addColumn:
        tableName: USERS
        columns:
        - column:
            name: ID
            type: UUID
            remarks: The Database internal ID
            valueComputed: uuid_generate_v4()
          constraints:
          - primaryKey: true
          - primaryKeyName: USERS_PK
          - nullable: false
          - notNullConstraintName: USERS_ID_NN
          - unique: true
          - uniqueConstraintName: USERS_ID_UK

    - addColumn:
        tableName: PLAYERLOG
        columns:
        - column:
            name: ID
            type: UUID
            remarks: The Database internal ID
            valueComputed: uuid_generate_v4()
          constraints:
          - primaryKey: true
          - primaryKeyName: PLAYERLOG_PK
          - nullable: false
          - notNullConstraintName: PLAYERLOG_ID_NN
          - unique: true
          - uniqueConstraintName: PLAYERLOG_ID_UK

    - addColumn:
        tableName: PLAYERLOG
        columns:
        - column:
            name: PLAYER
            type: UUID
            remarks: 'The player referenced in this entry'
          constraints:
            - nullable: false
            - notNullConstraintName: PLAYERLOG_USER_NN
            - foreignKeyName: PLAYERLOG_USERS_FK
            - referencedTableName: USERS
            - referencedColumnName: ID

    - addForeignKeyConstraint:
        baseTableName: PLAYERLOG
        baseColumnNames: PLAYER
        constraintName: PLAYERLOG_USER_FK
        referencedTableName: USERS
        referencedColumnNames: ID
        deferrable: false
        initiallyDeferred: false
        deleteCascade: false
        referencesUniqueColumn: true
        validate: true
